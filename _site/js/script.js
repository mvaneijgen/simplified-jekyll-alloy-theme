/*touch*/
!function(a){function f(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var e,b=a.ui.mouse.prototype,c=b._mouseInit,d=b._mouseDestroy;b._touchStart=function(a){var b=this;!e&&b._mouseCapture(a.originalEvent.changedTouches[0])&&(e=!0,b._touchMoved=!1,f(a,"mouseover"),f(a,"mousemove"),f(a,"mousedown"))},b._touchMove=function(a){e&&(this._touchMoved=!0,f(a,"mousemove"))},b._touchEnd=function(a){e&&(f(a,"mouseup"),f(a,"mouseout"),this._touchMoved||f(a,"click"),e=!1)},b._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),c.call(b)},b._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),d.call(b)}}}(jQuery);

/*transit*/
(function(e,t){if(typeof define==="function"&&define.amd){define(["jquery"],t)}else if(typeof exports==="object"){module.exports=t(require("jquery"))}else{t(e.jQuery)}})(this,function(e){function r(e){if(e in t.style)return e;var n=["Moz","Webkit","O","ms"];var r=e.charAt(0).toUpperCase()+e.substr(1);for(var i=0;i<n.length;++i){var s=n[i]+r;if(s in t.style){return s}}}function i(){t.style[n.transform]="";t.style[n.transform]="rotateY(90deg)";return t.style[n.transform]!==""}function f(e){if(typeof e==="string"){this.parse(e)}return this}function l(e,t,n){if(t===true){e.queue(n)}else if(t){e.queue(t,n)}else{e.each(function(){n.call(this)})}}function c(t){var r=[];e.each(t,function(t){t=e.camelCase(t);t=e.transit.propertyMap[t]||e.cssProps[t]||t;t=d(t);if(n[t])t=d(n[t]);if(e.inArray(t,r)===-1){r.push(t)}});return r}function h(t,n,r,i){var s=c(t);if(e.cssEase[r]){r=e.cssEase[r]}var o=""+m(n)+" "+r;if(parseInt(i,10)>0){o+=" "+m(i)}var u=[];e.each(s,function(e,t){u.push(t+" "+o)});return u.join(", ")}function p(t,r){if(!r){e.cssNumber[t]=true}e.transit.propertyMap[t]=n.transform;e.cssHooks[t]={get:function(n){var r=e(n).css("transit:transform");return r.get(t)},set:function(n,r){var i=e(n).css("transit:transform");i.setFromString(t,r);e(n).css({"transit:transform":i})}}}function d(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function v(e,t){if(typeof e==="string"&&!e.match(/^[\-0-9\.]+$/)){return e}else{return""+e+t}}function m(t){var n=t;if(typeof n==="string"&&!n.match(/^[\-0-9\.]+/)){n=e.fx.speeds[n]||e.fx.speeds._default}return v(n,"ms")}e.transit={version:"0.9.12",propertyMap:{marginLeft:"margin",marginRight:"margin",marginBottom:"margin",marginTop:"margin",paddingLeft:"padding",paddingRight:"padding",paddingBottom:"padding",paddingTop:"padding"},enabled:true,useTransitionEnd:false};var t=document.createElement("div");var n={};var s=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;n.transition=r("transition");n.transitionDelay=r("transitionDelay");n.transform=r("transform");n.transformOrigin=r("transformOrigin");n.filter=r("Filter");n.transform3d=i();var o={transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd"};var u=n.transitionEnd=o[n.transition]||null;for(var a in n){if(n.hasOwnProperty(a)&&typeof e.support[a]==="undefined"){e.support[a]=n[a]}}t=null;e.cssEase={_default:"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeInCubic:"cubic-bezier(.550,.055,.675,.190)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"};e.cssHooks["transit:transform"]={get:function(t){return e(t).data("transform")||new f},set:function(t,r){var i=r;if(!(i instanceof f)){i=new f(i)}if(n.transform==="WebkitTransform"&&!s){t.style[n.transform]=i.toString(true)}else{t.style[n.transform]=i.toString()}e(t).data("transform",i)}};e.cssHooks.transform={set:e.cssHooks["transit:transform"].set};e.cssHooks.filter={get:function(e){return e.style[n.filter]},set:function(e,t){e.style[n.filter]=t}};if(e.fn.jquery<"1.8"){e.cssHooks.transformOrigin={get:function(e){return e.style[n.transformOrigin]},set:function(e,t){e.style[n.transformOrigin]=t}};e.cssHooks.transition={get:function(e){return e.style[n.transition]},set:function(e,t){e.style[n.transition]=t}}}p("scale");p("scaleX");p("scaleY");p("translate");p("rotate");p("rotateX");p("rotateY");p("rotate3d");p("perspective");p("skewX");p("skewY");p("x",true);p("y",true);f.prototype={setFromString:function(e,t){var n=typeof t==="string"?t.split(","):t.constructor===Array?t:[t];n.unshift(e);f.prototype.set.apply(this,n)},set:function(e){var t=Array.prototype.slice.apply(arguments,[1]);if(this.setter[e]){this.setter[e].apply(this,t)}else{this[e]=t.join(",")}},get:function(e){if(this.getter[e]){return this.getter[e].apply(this)}else{return this[e]||0}},setter:{rotate:function(e){this.rotate=v(e,"deg")},rotateX:function(e){this.rotateX=v(e,"deg")},rotateY:function(e){this.rotateY=v(e,"deg")},scale:function(e,t){if(t===undefined){t=e}this.scale=e+","+t},skewX:function(e){this.skewX=v(e,"deg")},skewY:function(e){this.skewY=v(e,"deg")},perspective:function(e){this.perspective=v(e,"px")},x:function(e){this.set("translate",e,null)},y:function(e){this.set("translate",null,e)},translate:function(e,t){if(this._translateX===undefined){this._translateX=0}if(this._translateY===undefined){this._translateY=0}if(e!==null&&e!==undefined){this._translateX=v(e,"px")}if(t!==null&&t!==undefined){this._translateY=v(t,"px")}this.translate=this._translateX+","+this._translateY}},getter:{x:function(){return this._translateX||0},y:function(){return this._translateY||0},scale:function(){var e=(this.scale||"1,1").split(",");if(e[0]){e[0]=parseFloat(e[0])}if(e[1]){e[1]=parseFloat(e[1])}return e[0]===e[1]?e[0]:e},rotate3d:function(){var e=(this.rotate3d||"0,0,0,0deg").split(",");for(var t=0;t<=3;++t){if(e[t]){e[t]=parseFloat(e[t])}}if(e[3]){e[3]=v(e[3],"deg")}return e}},parse:function(e){var t=this;e.replace(/([a-zA-Z0-9]+)\((.*?)\)/g,function(e,n,r){t.setFromString(n,r)})},toString:function(e){var t=[];for(var r in this){if(this.hasOwnProperty(r)){if(!n.transform3d&&(r==="rotateX"||r==="rotateY"||r==="perspective"||r==="transformOrigin")){continue}if(r[0]!=="_"){if(e&&r==="scale"){t.push(r+"3d("+this[r]+",1)")}else if(e&&r==="translate"){t.push(r+"3d("+this[r]+",0)")}else{t.push(r+"("+this[r]+")")}}}}return t.join(" ")}};e.fn.transition=e.fn.transit=function(t,r,i,s){var o=this;var a=0;var f=true;var c=e.extend(true,{},t);if(typeof r==="function"){s=r;r=undefined}if(typeof r==="object"){i=r.easing;a=r.delay||0;f=typeof r.queue==="undefined"?true:r.queue;s=r.complete;r=r.duration}if(typeof i==="function"){s=i;i=undefined}if(typeof c.easing!=="undefined"){i=c.easing;delete c.easing}if(typeof c.duration!=="undefined"){r=c.duration;delete c.duration}if(typeof c.complete!=="undefined"){s=c.complete;delete c.complete}if(typeof c.queue!=="undefined"){f=c.queue;delete c.queue}if(typeof c.delay!=="undefined"){a=c.delay;delete c.delay}if(typeof r==="undefined"){r=e.fx.speeds._default}if(typeof i==="undefined"){i=e.cssEase._default}r=m(r);var p=h(c,r,i,a);var d=e.transit.enabled&&n.transition;var v=d?parseInt(r,10)+parseInt(a,10):0;if(v===0){var g=function(e){o.css(c);if(s){s.apply(o)}if(e){e()}};l(o,f,g);return o}var y={};var b=function(t){var r=false;var i=function(){if(r){o.unbind(u,i)}if(v>0){o.each(function(){this.style[n.transition]=y[this]||null})}if(typeof s==="function"){s.apply(o)}if(typeof t==="function"){t()}};if(v>0&&u&&e.transit.useTransitionEnd){r=true;o.bind(u,i)}else{window.setTimeout(i,v)}o.each(function(){if(v>0){this.style[n.transition]=p}e(this).css(c)})};var w=function(e){this.offsetWidth;b(e)};l(o,f,w);return this};e.transit.getTransitionValue=h;return e})

/*dragboard*/
!function(t){function a(){for(var t=l.requirements,a=c.checklist,r=!0,e=0;e<t.length;e++){var i=l.requirements[e].slice(0);r=!0;for(var o=0;o<i.length;o++){var d,n=i[o];"#"==n.charAt(0)?(d=a.indexOf(n.substring(1)),d>-1&&(r=!1)):(d=a.indexOf(n),-1==d&&(r=!1))}if(r)break}return r}function r(){if(0!=l.scaleFactor){var a=l.scaleFactor;t(".dragboard").css({width:Math.round(f.width()*a),height:Math.round(f.height()*a)}),t(".dragger").each(function(){var r=t(this).data("height")?t(this).data("height"):t(this).height(),e=t(this).data("width")?t(this).data("width"):t(this).width();t(this).data("height",Math.round(parseInt(r)*a)),t(this).data("width",Math.round(parseInt(e)*a));for(var i=["top","left","right","bottom"],o=0;o<i.length;o++)t(this).data(i[o])&&t(this).data(i[o],Math.round(parseInt(t(this).data(i[o]))*a));if(t(this).data("snap-offset")){var d=t(this).data("snap-offset").split(","),n=Math.round(parseInt(d[0])*a)+","+Math.round(parseInt(d[1])*a);t(this).data("snap-offset",n)}if(t(this).data("drop-image-size")){var s=t(this).data("drop-image-size").split(","),h=Math.round(parseInt(s[0])*a)+","+Math.round(parseInt(s[1])*a);t(this).data("drop-image-size",h)}}),t(".dropper").each(function(){var r=t(this).data("height")?t(this).data("height"):t(this).height(),e=t(this).data("width")?t(this).data("width"):t(this).width();t(this).data("height",Math.round(parseInt(r)*a)),t(this).data("width",Math.round(parseInt(e)*a));for(var i=["top","left","right","bottom"],o=0;o<i.length;o++)t(this).data(i[o])&&t(this).data(i[o],Math.round(parseInt(t(this).data(i[o]))*a));if(t(this).data("snap-offset")){var d=t(this).data("snap-offset").split(","),n=Math.round(parseInt(d[0])*a)+","+Math.round(parseInt(d[1])*a);t(this).data("snap-offset",n)}if(t(this).data("drop-image-size")){var s=t(this).data("drop-image-size").split(","),h=Math.round(parseInt(s[0])*a)+","+Math.round(parseInt(s[1])*a);t(this).data("drop-image-size",h)}})}}function e(){var a=new Array;t(".dragger").each(function(r){var e=t(this).data("drop-image");e&&(a[r]=e)}),o(a)}function i(){t(".dropper",f).droppable({drop:function(a,r){var e=t(this).data("id"),i=t(r.draggable).data("id"),o=h(i,e);o.dropper.allowed&&(r.draggable.data("dropped",!0),r.draggable.data("dropper_id",e))},over:function(){c.OnDropHover(t(this))},out:function(){c.OnDropHoverOut(t(this))}})}function o(a){t(a).each(function(){t("<img/>")[0].src=this})}function d(){t(".dragger",f).draggable({containment:"parent",start:function(a,r){r.helper.data("dropped",!1),r.helper.data("dropper_id",!1),t(this).draggable("option","revert",function(a){c.OnAnyMove();var r=!0,e=t(this).attr("id");if(a){var i=a.attr("id"),o=h(e,i);if(!o.dropper.allowed)var r=!1}if(s(e,t(this).attr("data-in-dropper"),!1),a&&!r){var d=new Object;d.dropper=a,d.dragger=t(this),c.onWrongMove(d),t(this).removeClass("dropped")}if(a&&r){var d=new Object;d.dropper=a,d.dragger=t(this),n(d),t(this).addClass("dropped")}return a&&r?void 0:(t(this).removeClass("dropped"),t(this).removeAttr("data-in-dropper"),t(this).data("ui-draggable").originalPosition={top:t(this).data("origin-top"),left:t(this).data("origin-left")},!0)})},stop:function(a,r){if(t('.dragboard .dropper[data-busy="'+t(this).data("id")+'"]').removeAttr("data-busy"),r.helper.data("dropped")){var e=r.helper.data("dropper_id"),i=t(this).data("id"),o=t(".dropper#"+e),d=h(i,e);if(!d.dropper.allowed)return!1;s(i,e,!0),t(this).attr("data-in-dropper",e),t(this).transition({opacity:.1,scale:.3},250,function(){if(t(this).transition({opacity:1,scale:1},200),d.dragger.dropImage){{t(this).attr("src")}t(this).one("load",function(){}).attr("src",d.dragger.dropImage)}if(d.dragger.dropImageSize){var r=d.dragger.dropImageSize;t(this).css("height",r[0]).css("width",r[1]);var e=a.pageX-Math.floor(t(this).width()/2)-f.offset().left,n=a.pageY-Math.floor(t(this).height()/2)-f.offset().top;e=0>=e?0:e,e=e>=f.width()-t(this).width()?f.width()-t(this).width():e,n=0>=n?0:n,n=n>=f.height()-t(this).height()?f.height()-t(this).height():n,t(this).css({left:e,top:n})}if(d.dropper.noStacking&&o.attr("data-busy",i),d.dragger.snap){t(this).draggable("option","revert",!1);var s=o.position(),h=Array(0,0),p=t(this).data("snap-offset");o.data("snap-offset")&&(p=o.data("snap-offset")),p&&(h=p.split(",")),t(this).css("left",parseInt(s.left)+parseInt(h[0])).css("top",parseInt(s.top)+parseInt(h[1]))}else t(this).draggable("option","revert",!1);d.dropper.keepMoving||t(this).draggable("disable")})}l.autocheck&&u.check()}}),t(".dragger").each(function(){t(this).attr("data-url",t(this).attr("src"))}),t(".dragger").bind("mousedown",function(){if(t(this).hasClass("ui-draggable-disabled"))return!1;t(this).removeClass("dropped");var a=t(this);t(this).data("drop-image")&&a.attr("src",a.data("url")),a.width()!=a.data("width")?(a.css("height",a.data("height")).css("width",a.data("width")),a.css({left:event.pageX-Math.floor(a.width()/2)-f.offset().left,top:event.pageY-Math.floor(a.height()/2)-f.offset().top}),a.draggable("option","cursorAt",{left:Math.floor(a.width()/2),top:Math.floor(a.height()/2)})):a.draggable("option","cursorAt",{})}),t(".dragger").click(function(){return t(this).hasClass("ui-draggable-disabled")?!1:void(t(this).attr("data-in-dropper")&&""!=t(this).attr("data-in-dropper")&&(c.OnAnyMove(),t(this).data("not-return-on-click")||(t(this).animate({left:t(this).data("origin-left"),top:t(this).data("origin-top")}),s(t(this).data("id"),t(this).attr("data-in-dropper"),!1),t(this).removeAttr("data-in-dropper"),t('.dragboard .dropper[data-busy="'+t(this).data("id")+'"]').removeAttr("data-busy"))))})}function n(t){c.OnGoodMove(t)}function s(t,a,r){var e=a+":"+t;if(r)c.checklist.indexOf(e)<0&&c.checklist.push(e);else if(c.checklist.indexOf(e)>-1){var i=c.checklist.indexOf(e);i>-1&&c.checklist.splice(i,1)}}function h(a,r){var e=new Array,i=new Object;i.dragger=new Object,i.dropper=new Object;var o=t(".dragger#"+a),d=t(".dropper#"+r);if(i.dragger.width=o.width(),i.dragger.height=o.height(),i.dragger.snap=0==o.data("snap")||0==d.data("snap")?!1:!0,i.dragger.dropImage=o.data("drop-image")?o.data("drop-image"):!1,i.dropper.width=d.width(),i.dropper.height=d.height(),i.dropper.allowed=!1,i.dropper.noStacking=1==d.data("no-stacking")?!0:!1,i.dropper.keepMoving=0==d.data("keep-moving")?!1:!0,i.dragger.dropImageSize=!1,d.data("drop-image-size")?i.dragger.dropImageSize=d.data("drop-image-size").split(","):o.data("drop-image-size")&&(i.dragger.dropImageSize=o.data("drop-image-size").split(",")),d.data("allow")){var n=d.data("allow").replace(" ","");e=n.split(","),i.dropper.allow_list=e,e.indexOf(a)>-1&&g(r,a)&&(i.dropper.allowed=!0)}else g(r,a)&&(i.dropper.allowed=!0);return i}function p(a){for(var r=["left","right","top","bottom","width","height"],e=0;6>e;e++)if("undefined"!=typeof t(a).data(r[e])&&t(a).data(r[e])!==!1){var i=t(a).data(r[e]).toString();t(a).css(r[e],i+"px")}t(a).attr("data-origin-top",t(a).position().top),t(a).attr("data-origin-left",t(a).position().left)}function g(a,r){return t(".dragboard .dropper#"+a).data("no-stacking")&&t(".dragboard .dropper#"+a).attr("data-busy")&&t(".dragboard .dropper#"+a).attr("data-busy")!=r?!1:!0}var f,c={onDone:function(){},onWrongMove:function(){},OnGoodMove:function(){},OnAnyMove:function(){},OnDropHover:function(){},OnDropHoverOut:function(){},checklist:Array()},l={mode:"normal",autocheck:!0,requirements:Array(),scaleFactor:0},u={init:function(a){f=t(this),l=t.extend(l,a),r(),"testing"==l.mode&&t(f).addClass("testing"),d(),i(),t(".dragger, .dropper",f).each(function(){p(this)}),t(".dragger, .dropper",f).each(function(){var a=t(this).data("id");a&&t(this).attr("id",a)}),e()},setOnDone:function(t){c.onDone=t},setOnWrongMove:function(t){c.onWrongMove=t},setOnGoodMove:function(t){c.OnGoodMove=t},setOnAnyMove:function(t){c.OnAnyMove=t},setOnDropHover:function(t){c.OnDropHover=t},setOnDropHoverOut:function(t){c.OnDropHoverOut=t},check:function(){var t=a();if(t){var r=new Object;r.done=!0,c.onDone(r)}if(!l.autocheck&&!t){var r=new Object;r.done=!1,c.onDone(r)}}};t.fn.dragboard=function(a){return u[a]?u[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void t.error("Method "+a+" does not exist on jQuery.dragboard"):u.init.apply(this,arguments)}}(jQuery);
$(function(){
	
	factor = 1;
	
	if($('#dd_game').width() < 1024)
	{
		factor = parseInt($('#dd_game').width())/1024;
	}
	
	$('.dragboard').dragboard({
		scaleFactor: factor
	});
	
	$('.dragboard').dragboard('setOnGoodMove', function(e){
		setTimeout(function(){
			dragDropDone();
		}, 1000);
	});
	
	function dragDropDone()
	{
		$('.dd_overlay').addClass('show');
	}
	
});
